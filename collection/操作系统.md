# 操作系统

- [进程，线程，协程](#进程，线程，协程)

  * [简述线程和进程的区别和联系](#简述线程和进程的区别和联系)

  * [进程的状态与状态转换](#进程的状态与状态转换)

  * [并发和并行有什么区别？](#并发和并行有什么区别？)
  
  * [什么是内核态和用户态？如何实现两者之间的相互转换？](#什么是内核态和用户态？如何实现两者之间的相互转换？)

## 进程，线程，协程

### 简述线程和进程，协程的区别和联系

区别

1. 进程是对运行时程序的封装，是系统进行资源分配和调度的基本单元，而线程是进程的子任务，是CPU分配和调度的基本单元。
2. 一个进程可以有多个线程，但是一个线程只能属于一个进程。一个线程可以有多个协程，一个进程也可以有多个协程。
3. 进程的创建需要系统分配内存和CPU等资源，销毁时也要进行相应的回收，所以进程的管理开销很大；但是线程的管理开销则很小。
4. 进程之间不会相互影响；而一个线程崩溃会导致进程崩溃，从而影响同个进程里面的其他线程。
5. 线程和进程都是同步机制，而协程是异步机制。
6. 协程不被操作系统内核管理，而完全是由程序控制。协程进行中断跳转时将函数的上下文存放在其他位置中，而不是存放在函数堆栈里，当处理完其他事情跳转回来的时候，取回上下文继续执行原来的函数。

联系 进程与线程之间的关系：线程是存在进程的内部，一个进程中可以有多个线程，一个线程只能存在一个进程中。一个线程可以有多个协程，一个进程也可以有多个协程。

### 进程的状态与状态转换

进程在运行时有三种基本状态：就绪态、运行态和阻塞态。

1. 执行：进程分到CPU时间片，可以执行
2. 就绪：进程已经就绪，只要分配到CPU时间片，随时可以执行
3. 阻塞：有IO事件或者等待其他资源

各状态之间的转换：

1. 就绪→执行 处于就绪状态的进程，当进程调度程序为之分配了处理机后，该进程便由就绪状态转变成执行状态。
2. 执行→就绪 处于执行状态的进程在其执行过程中，因分配给它的一个时间片已用完而不得不让出处理机，于是进程从执行状态转变成就绪状态。
3. 执行→阻塞 正在执行的进程因等待某种事件发生而无法继续执行时，便从执行状态变成阻塞状态。
4. 阻塞→就绪 处于阻塞状态的进程，若其等待的事件已经发生，于是进程由阻塞状态转变为就绪状态。

### 并发和并行有什么区别？

并发就是在一段时间内，多个任务都会被处理；但在某一时刻，只有一个任务在执行。因为切换速度足够快，所以宏观上表现为在一段时间内能同时运行多个程序。

并行就是在同一时刻，有多个任务在执行。这个是物理上的多个进程同时进行。

### 什么是内核态和用户态？如何实现两者之间的相互转换？

为了避免操作系统和关键数据被用户程序破坏，将处理器的执行状态分为内核态和用户态。

内核态是操作系统管理程序执行时所处的状态，能够执行包含特权指令在内的一切指令，能够访问系统内所有的存储空间。

用户态是用户程序执行时处理器所处的状态，不能执行特权指令，只能访问用户地址空间。

用户程序运行在用户态,操作系统内核运行在内核态。

处理器从用户态切换到内核态的方法有三种：系统调用、异常和外部中断。

1. 系统调用是操作系统的最小功能单位，是操作系统提供的用户接口，系统调用本身是一种软中断。
2. 异常，也叫做内中断，是由错误引起的，如文件损坏、缺页故障等。
3. 外部中断，是通过两根信号线来通知处理器外设的状态变化，是硬中断。

